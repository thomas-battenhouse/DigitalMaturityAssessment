<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital EHS&S Maturity Assessment</title>
    <!-- Use a modern font and Tailwind CSS for styling -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom colors for the KPI cards */
        .kpi-blue { background-color: #2563EB; }
        .kpi-teal { background-color: #0D9488; }
        .kpi-orange { background-color: #EA580C; }
        .kpi-emerald { background-color: #059669; }
        .kpi-purple { background-color: #7C3AED; }
        .kpi-rose { background-color: #E11D48; }

        canvas {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-8">

    <div class="max-w-4xl mx-auto bg-white p-6 sm:p-10 rounded-3xl shadow-2xl">
        <header class="text-center mb-10">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-blue-800 mb-2">Digital EHS&S Maturity</h1>
            <p class="text-lg text-gray-600">Assess your organization's digital maturity across six key pillars.</p>
        </header>

        <!-- Questionnaire Section -->
        <form id="assessment-form">
            <!-- This section will be populated dynamically by JavaScript -->
        </form>

        <!-- Results Dashboard Section -->
        <div id="results-dashboard" class="hidden text-center">
            <h2 class="text-3xl font-extrabold text-blue-800 mb-6">Your Maturity Dashboard</h2>
            <p class="text-lg text-gray-600 mb-10">
                Below are your calculated average scores for each pillar.
            </p>
            <!-- Radar Chart Canvas -->
            <div class="flex justify-center my-8">
                <canvas id="radar-chart" class="rounded-2xl"></canvas>
            </div>
            <div id="kpi-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- KPI cards will be dynamically added here -->
            </div>
            <!-- Overall Composite Score box removed as requested -->
            <!-- Legend -->
            <div id="legend-container" class="mt-8 p-6 rounded-2xl bg-gray-50 border border-gray-200 text-gray-700">
                <!-- Legend will be added here -->
            </div>
            <button id="reset-button" class="mt-12 bg-gray-700 text-white font-bold py-3 px-8 rounded-xl text-md shadow-xl transition-all hover:bg-gray-800 focus:outline-none focus:ring-4 focus:ring-gray-400">
                Take Assessment Again
            </button>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 1. DATA DEFINITION ---
            // Define the questionnaire data as a JavaScript array of objects.
            const questionnaireData = [
                {
                    id: 'governance',
                    title: '1. Governance & Leadership',
                    questions: [
                        'Our EHS&S strategy is deliberately and visibly aligned with the company\'s core business objectives and strategic planning process.',
                        'There is active, visible sponsorship of digital EHS&S initiatives from our C-suite and senior leadership.',
                        'We have a dedicated, cross-functional governance committee that oversees our digital EHS&S strategy.',
                        'EHS&S initiatives are viewed as a source of competitive advantage and operational excellence, not just a compliance function.',
                        'Leaders at all levels actively champion the adoption of new digital EHS&S tools and processes.',
                    ],
                },
                {
                    id: 'process',
                    title: '2. Process Digitalization',
                    questions: [
                        'Our EHS&S data is predominantly collected using automated digital methods, with minimal reliance on manual or paper-based processes.',
                        'Our EHS&S workflows (e.g., incident reporting, corrective actions) are fully digital from start to finish.',
                        'Approvals, escalations, and notifications for EHS&S processes are fully automated within our digital systems.',
                        'Our EHS&S reports are generated in near real-time and are always up-to-date.',
                        'Our EHS&S processes are designed for an end-to-end digital experience, not just for digitizing manual data entry.',
                    ],
                },
                {
                    id: 'agility',
                    title: '3. Digital Workforce Agility',
                    questions: [
                        'Our employees receive continuous training on new digital tools and technologies beyond what is required for basic compliance.',
                        'The company actively seeks and rewards fresh ideas from the entire workforce for improving EHS&S processes.',
                        'Employees are empowered to experiment with new, AI-assisted workflows or digital tools to solve EHS&S challenges.',
                        'The concept of continuous improvement is a cultural norm and is deeply ingrained in our EHS&S practices.',
                        'Employees feel a sense of ownership over the digital tools they use and contribute to their ongoing refinement.',
                    ],
                },
                {
                    id: 'analytics',
                    title: '4. Performance Monitoring and Analytics',
                    questions: [
                        'Our EHS&S reporting goes beyond basic reactionary data and includes in-depth trending and analysis.',
                        'Our EHS&S metrics are directly linked to and inform broader business outcomes.',
                        'We regularly use predictive analytics and machine learning to forecast potential EHS&S risks or identify emerging trends.',
                        'We can easily and accurately benchmark our EHS&S performance against industry peers in real-time.',
                        'We use AI-driven analysis to extract strategic insights from our EHS&S data that inform executive decision-making.',
                    ],
                },
                {
                    id: 'systems',
                    title: '5. Connected Systems',
                    questions: [
                        'Our EHS&S data is seamlessly exchanged with other enterprise platforms like ERP, HR, and supply chain systems.',
                        'Our systems automatically share and synchronize EHS&S data across the enterprise, eliminating manual data transfer.',
                        'Data from our different EHS&S tools has been merged into a single, consolidated data stream for unified analysis.',
                        'We have a fully connected architecture that enables real-time data flow from IoT sensors to our EHS&S platform.',
                        'We can automatically and easily pull EHS&S data for ESG reporting platforms without manual intervention.',
                    ],
                },
                {
                    id: 'risk',
                    title: '6. Risk Intelligence',
                    questions: [
                        'We conduct formal, systematic, and frequent risk assessments across all our operations.',
                        'We receive real-time alerts for high-risk events based on continuous data streaming from our connected network.',
                        'Our system automatically escalates critical safety or environmental issues to the appropriate personnel.',
                        'We have a systematic, automated approach for measuring the frequency and consequences of EHS&S events.',
                        'Our risk management is based on predictive models that use data to identify key risk factors in real-time.',
                    ],
                },
            ];
            
            const form = document.getElementById('assessment-form');
            const resultsDashboard = document.getElementById('results-dashboard');
            const kpiContainer = document.getElementById('kpi-container');
            const legendContainer = document.getElementById('legend-container');
            const resetButton = document.getElementById('reset-button');
            const kpiColors = ['kpi-blue', 'kpi-teal', 'kpi-orange', 'kpi-emerald', 'kpi-purple', 'kpi-rose'];

            // --- 2. DYNAMICALLY GENERATE FORM HTML ---
            function renderForm() {
                form.innerHTML = ''; // Clear previous content
                questionnaireData.forEach((pillar, pillarIndex) => {
                    const pillarDiv = document.createElement('div');
                    pillarDiv.className = 'mb-8 p-6 bg-gray-50 rounded-2xl shadow-inner border border-gray-200';
                    
                    const title = document.createElement('h2');
                    title.className = 'text-2xl font-bold text-blue-700 mb-4';
                    title.textContent = pillar.title;
                    pillarDiv.appendChild(title);

                    const subtitle = document.createElement('p');
                    subtitle.className = 'text-md text-gray-600 mb-4 font-medium';
                    subtitle.textContent = 'Rate the degree to which the following statements are true for your organization - with 1 being the least true and 5 being the most.';
                    pillarDiv.appendChild(subtitle);

                    pillar.questions.forEach((question, qIndex) => {
                        const questionDiv = document.createElement('div');
                        questionDiv.className = 'mb-6';
                        questionDiv.innerHTML = `<p class="text-md mb-2 font-medium leading-relaxed">${qIndex + 1}. ${question}</p>`;
                        
                        const buttonContainer = document.createElement('div');
                        buttonContainer.className = 'flex flex-wrap items-center space-x-2 sm:space-x-4';
                        
                        for (let score = 1; score <= 5; score++) {
                            const button = document.createElement('button');
                            button.type = 'button';
                            button.textContent = score;
                            button.className = 'px-4 py-2 rounded-xl text-lg font-bold transition-transform transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 bg-gray-200 text-gray-700 hover:bg-gray-300';
                            
                            // Attach a data attribute to the button to link it to the question
                            button.setAttribute('data-pillar-id', pillar.id);
                            button.setAttribute('data-q-index', qIndex);

                            // Attach event listener to handle button selection
                            button.addEventListener('click', () => {
                                // Deactivate all other buttons for this specific question
                                buttonContainer.querySelectorAll('button').forEach(btn => {
                                    btn.className = btn.className.replace('bg-blue-500 text-white shadow-lg', 'bg-gray-200 text-gray-700 hover:bg-gray-300');
                                });
                                // Activate the clicked button
                                button.className = button.className.replace('bg-gray-200 text-gray-700 hover:bg-gray-300', 'bg-blue-500 text-white shadow-lg');
                                
                                // Store the selected score in the button's data attribute
                                button.setAttribute('data-score', score);
                            });
                            buttonContainer.appendChild(button);
                        }
                        questionDiv.appendChild(buttonContainer);
                        pillarDiv.appendChild(questionDiv);
                    });
                    form.appendChild(pillarDiv);
                });

                // Add the submit button at the end
                const submitButton = document.createElement('button');
                submitButton.type = 'submit';
                submitButton.textContent = 'Submit Assessment';
                submitButton.className = 'w-full sm:w-auto bg-blue-600 text-white font-bold py-4 px-12 rounded-xl text-lg shadow-xl transition-all hover:bg-blue-700 hover:shadow-2xl focus:outline-none focus:ring-4 focus:ring-blue-400 mt-10';
                form.appendChild(submitButton);
            }

            // --- 3. EVENT LISTENERS ---
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const answeredScores = {};
                // Select all buttons that have a data-score attribute
                const scoreButtons = form.querySelectorAll('[data-score]');

                // Iterate through the answered buttons and store the scores
                scoreButtons.forEach(button => {
                    const pillarId = button.getAttribute('data-pillar-id');
                    const score = parseInt(button.getAttribute('data-score'));
                    
                    if (!answeredScores[pillarId]) {
                        answeredScores[pillarId] = { total: 0, count: 0 };
                    }
                    if (!isNaN(score)) {
                        answeredScores[pillarId].total += score;
                        answeredScores[pillarId].count++;
                    }
                });

                const results = {};
                let totalCompositeScore = 0;
                let totalQuestionsAnswered = 0;

                questionnaireData.forEach(pillar => {
                    const scores = answeredScores[pillar.id];
                    if (scores && scores.count > 0) {
                        const avg = (scores.total / scores.count).toFixed(1);
                        results[pillar.title] = avg;
                        totalCompositeScore += scores.total;
                        totalQuestionsAnswered += scores.count;
                    } else {
                        results[pillar.title] = '0.0';
                    }
                });
                
                let compositeScore = 0;
                if (totalQuestionsAnswered > 0) {
                    compositeScore = Math.round(totalCompositeScore / totalQuestionsAnswered);
                }

                renderResults(results, compositeScore);
                form.classList.add('hidden');
                resultsDashboard.classList.remove('hidden');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            // --- 4. RENDER RESULTS ---
            function renderResults(results, compositeScore) {
                kpiContainer.innerHTML = ''; // Clear previous results
                legendContainer.innerHTML = '';

                // Render the radar chart visualization
                renderRadarChart(results);

                const pillars = Object.keys(results);
                pillars.forEach((pillar, index) => {
                    const kpiDiv = document.createElement('div');
                    kpiDiv.className = `${kpiColors[index % kpiColors.length]} text-white p-8 rounded-2xl shadow-lg flex flex-col items-center justify-center text-center transform transition-all duration-300 hover:scale-105`;
                    
                    const title = document.createElement('h3');
                    title.className = 'text-xl font-bold mb-2 leading-tight';
                    title.textContent = pillar;

                    const scoreDisplay = document.createElement('div');
                    scoreDisplay.className = 'text-5xl font-extrabold';
                    scoreDisplay.textContent = results[pillar];
                    
                    const subtext = document.createElement('p');
                    subtext.className = 'text-sm mt-2 opacity-90';
                    subtext.textContent = 'Avg. Score';
                    
                    kpiDiv.appendChild(title);
                    kpiDiv.appendChild(scoreDisplay);
                    kpiDiv.appendChild(subtext);
                    
                    kpiContainer.appendChild(kpiDiv);
                });
                
                // Render Legend
                const legendTitle = document.createElement('h4');
                legendTitle.className = 'text-3xl font-extrabold text-blue-800 mb-6 text-center';
                legendTitle.textContent = 'Overall Digital Maturity';
                legendContainer.appendChild(legendTitle);

                const legendList = document.createElement('div');
                legendList.className = 'flex flex-wrap justify-center space-x-6 sm:space-x-8';
                
                for (let i = 1; i <= 5; i++) {
                    const legendItem = document.createElement('div');
                    
                    // Highlight the item that matches the composite score
                    let itemClass = `text-md flex items-center mb-2 px-4 py-2 whitespace-nowrap rounded-xl`;
                    if (i === compositeScore) {
                        itemClass += ` border-4 border-black`;
                    }
                    legendItem.className = itemClass;
                    
                    legendItem.innerHTML = `<span class="font-bold mr-2 text-blue-600">Level ${i}</span>`;
                    legendList.appendChild(legendItem);
                }
                legendContainer.appendChild(legendList);
            }

            // --- 5. RADAR CHART VISUALIZATION LOGIC ---
            function renderRadarChart(results) {
                const canvas = document.getElementById('radar-chart');
                const ctx = canvas.getContext('2d');
                const size = Math.min(400, window.innerWidth - 64);
                canvas.width = size;
                canvas.height = size;
                const centerX = size / 2;
                const centerY = size / 2;
                const radius = (size / 2) * 0.7; // Use 70% of the half-size for the chart
                const numPillars = questionnaireData.length;
                const angleIncrement = (Math.PI * 2) / numPillars;
                const pillarTitles = Object.keys(results);
                const scores = Object.values(results).map(score => parseFloat(score));

                // Clear the canvas
                ctx.clearRect(0, 0, size, size);

                // Draw the radar grid and labels
                ctx.strokeStyle = '#E2E8F0'; // light gray
                ctx.lineWidth = 1;
                ctx.fillStyle = '#475569'; // slate gray
                ctx.font = '14px Inter';

                for (let i = 0; i < numPillars; i++) {
                    const angle = i * angleIncrement - Math.PI / 2; // Start at the top
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    // Draw axis line
                    ctx.beginPath();
                    ctx.moveTo(centerX, centerY);
                    ctx.lineTo(x, y);
                    ctx.stroke();

                    // Draw labels
                    ctx.save();
                    ctx.translate(x, y);
                    ctx.rotate(angle);
                    ctx.textAlign = 'center';
                    ctx.fillText(pillarTitles[i].split('. ')[1], 0, -5);
                    ctx.restore();
                }

                // Draw score circles
                ctx.lineWidth = 1;
                for (let i = 1; i <= 5; i++) {
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, (radius / 5) * i, 0, 2 * Math.PI);
                    ctx.stroke();
                    ctx.fillText(i, centerX, centerY - (radius / 5) * i);
                }

                // Draw the data polygon
                ctx.beginPath();
                ctx.fillStyle = 'rgba(59, 130, 246, 0.4)'; // blue with transparency
                ctx.strokeStyle = '#3B82F6'; // solid blue
                ctx.lineWidth = 2;

                for (let i = 0; i < numPillars; i++) {
                    const angle = i * angleIncrement - Math.PI / 2;
                    const score = scores[i];
                    const pointRadius = (score / 5) * radius; // scale score to chart radius
                    const x = centerX + Math.cos(angle) * pointRadius;
                    const y = centerY + Math.sin(angle) * pointRadius;

                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
            }


            // --- 6. RESET FUNCTIONALITY ---
            resetButton.addEventListener('click', () => {
                form.classList.remove('hidden');
                resultsDashboard.classList.add('hidden');
                renderForm(); // Re-render a fresh form
            });

            // Initial rendering of the form
            renderForm();
        });
    </script>
</body>
</html>
